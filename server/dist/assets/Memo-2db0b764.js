import{a0 as Ae,a1 as De,a2 as _e,a3 as Fe,a4 as Be,d as Z,a5 as X,a6 as ze,a7 as Oe,a8 as Ue,a9 as $e,aa as Ve,ab as He,a as J,b as z,x as ee,r as N,ac as ie,n as _,j as n,I as j,ad as le,H as Qe,ae as We,u as xe,af as we,ag as Ye,h as Ce,ah as be,ai as Xe,aj as Ge,ak as Ke,al as Ne,am as ve,w as ye,an as qe,ao as K,t as Ze,ap as ce,aq as Je,ar as et,as as tt,at as st,au as G,av as Ee,i as ue,aw as de,K as nt,P as rt,ax as ot,ay as at,az as Me,aA as je,aB as it,aC as lt,aD as me,$ as ct,U as ut,l as dt,aE as mt}from"./index-d6fbc60c.js";var ht="[object Number]";function ft(d){return typeof d=="number"||Ae(d)&&De(d)==ht}function Se(d){return _e(d).toLowerCase()}function gt(d){return d&&d.length?Fe(d):[]}const te=()=>{const d=Be(i=>i.tag),r=Z();return{state:d,getState:()=>X.getState().tag,fetchTags:async()=>{const i={};r.isVisitorMode()&&(i.creatorUsername=r.getUsernameFromPath());const{data:c}=await ze(i);X.dispatch(Oe(c))},upsertTag:async i=>{await Ue(i),X.dispatch($e(i))},deleteTag:async i=>{await Ve(i),X.dispatch(He(i))}}},pt=d=>{const r=z(),{destroy:i,memoId:c}=d,m=ee(),[h,g]=N.useState(""),x=ie();N.useEffect(()=>{m.getMemoById(c).then(o=>{if(o){const a=ie(o.createdTs);g(a)}else _.error(r("message.memo-not-found")),i()})},[]);const t=()=>{i()},e=o=>{const a=o.target.value;g(a)},s=async()=>{const o=le(),a=le(h);if(a>o){_.error(r("message.invalid-created-datetime"));return}try{await m.patchMemo({id:c,createdTs:a}),_.success(r("message.memo-updated-datetime")),t()}catch(l){console.error(l),_.error(l.response.data.message)}};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"dialog-header-container",children:[n.jsx("p",{className:"title-text",children:r("message.change-memo-created-time")}),n.jsx("button",{className:"btn close-btn",onClick:t,children:n.jsx(j.X,{})})]}),n.jsxs("div",{className:"flex flex-col justify-start items-start !w-72 max-w-full",children:[n.jsxs("div",{className:"w-full bg-yellow-100 border border-yellow-400 rounded p-2 text-black",children:[n.jsx("p",{className:"uppercase",children:r("message.change-memo-created-time-warning-1")}),n.jsx("p",{children:r("message.change-memo-created-time-warning-2")})]}),n.jsx("input",{className:"input-text mt-2",type:"datetime-local",value:h,max:x,onChange:e}),n.jsxs("div",{className:"flex flex-row justify-end items-center mt-2 w-full",children:[n.jsx("span",{className:"btn-text",onClick:t,children:r("common.cancel")}),n.jsx("span",{className:"btn-primary",onClick:s,children:r("common.save")})]})]})]})};function xt(d){J({className:"change-memo-created-ts-dialog",dialogName:"change-memo-created-ts-dialog"},pt,{memoId:d})}const he={text:"common.select",value:""},wt=d=>{const{className:r,dataSource:i,handleValueChanged:c,value:m,disabled:h,tooltipTitle:g}=d,x=z(),[t,e]=Qe(!1),s=N.useRef(null);let o={text:x(he.text),value:he.value};for(const u of i)if(u.value===m){o=u;break}N.useEffect(()=>{if(t){const u=C=>{var w;(w=s.current)!=null&&w.contains(C.target)||e(!1)};window.addEventListener("click",u,{capture:!0,once:!0})}},[t]);const a=u=>{c&&c(u.value),e(!1)},l=u=>{h||(u.stopPropagation(),e())};return n.jsx(We,{title:g,hidden:!h,children:n.jsxs("div",{className:`selector-wrapper ${r??""} `,ref:s,children:[n.jsxs("div",{className:`current-value-container ${t?"active":""} ${h&&"selector-disabled"}`,onClick:l,children:[h&&n.jsx("span",{className:"lock-text",children:n.jsx(j.Lock,{className:"icon-img"})}),n.jsx("span",{className:"value-text",children:o.text}),!h&&n.jsx("span",{className:"arrow-text",children:n.jsx(j.ChevronDown,{className:"icon-img"})})]}),n.jsx("div",{className:`items-wrapper ${t?"":"!hidden"}`,children:i.length>0?i.map(u=>n.jsx("div",{className:`item-container ${u.value===m?"selected":""}`,onClick:()=>{a(u)},children:u.text},u.value)):n.jsx("p",{className:"tip-text",children:x("common.null")})})]})})},Ct=N.memo(wt),bt=d=>{const{value:r,onChange:i}=d,c=z(),{state:{systemStatus:m}}=xe(),h=we.map(x=>({value:x.value,text:c(`memo.visibility.${Se(x.value)}`)})),g=async x=>{i(x)};return n.jsx(Ct,{className:"visibility-selector",disabled:m.disablePublicMemos,tooltipTitle:c("memo.visibility.disabled"),value:r,dataSource:h,handleValueChanged:g})},Nt=d=>{const{onTagSelectorClick:r}=d,c=te().state.tags;return n.jsxs("div",{className:"action-btn relative group",children:[n.jsx(j.Hash,{className:"icon-img"}),n.jsx("div",{className:"hidden flex-row justify-start items-start flex-wrap absolute top-6 left-0 mt-1 p-1 z-1 rounded w-52 h-auto max-h-48 overflow-y-auto font-mono shadow bg-zinc-200 dark:bg-zinc-600 group-hover:flex",children:c.length>0?c.map(m=>n.jsxs("span",{className:"w-auto max-w-full truncate text-black dark:text-gray-300 cursor-pointer rounded text-sm leading-6 px-2 hover:bg-zinc-300 dark:hover:bg-zinc-700 shrink-0",onClick:()=>r(m),children:["#",m]},m)):n.jsx("p",{className:"italic text-sm ml-2",onClick:m=>m.stopPropagation(),children:"No tags found"})})]})};var Re={exports:{}};(function(d){(function(){var r=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],i=typeof window<"u",c=i&&window.mozInnerScreenX!=null;function m(h,g,x){if(!i)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var t=x&&x.debug||!1;if(t){var e=document.querySelector("#input-textarea-caret-position-mirror-div");e&&e.parentNode.removeChild(e)}var s=document.createElement("div");s.id="input-textarea-caret-position-mirror-div",document.body.appendChild(s);var o=s.style,a=window.getComputedStyle?window.getComputedStyle(h):h.currentStyle,l=h.nodeName==="INPUT";o.whiteSpace="pre-wrap",l||(o.wordWrap="break-word"),o.position="absolute",t||(o.visibility="hidden"),r.forEach(function(w){l&&w==="lineHeight"?o.lineHeight=a.height:o[w]=a[w]}),c?h.scrollHeight>parseInt(a.height)&&(o.overflowY="scroll"):o.overflow="hidden",s.textContent=h.value.substring(0,g),l&&(s.textContent=s.textContent.replace(/\s/g,"Â "));var u=document.createElement("span");u.textContent=h.value.substring(g)||".",s.appendChild(u);var C={top:u.offsetTop+parseInt(a.borderTopWidth),left:u.offsetLeft+parseInt(a.borderLeftWidth),height:parseInt(a.lineHeight)};return t?u.style.backgroundColor="#aaa":document.body.removeChild(s),C}d.exports=m})()})(Re);var vt=Re.exports;const yt=Ye(vt),Et=({editorRef:d,editorActions:r})=>{const[i,c]=N.useState(null),m=()=>c(null),{state:h}=te(),g=N.useRef(h.tags);g.current=h.tags;const[x,t]=N.useState(0),e=N.useRef(x);e.current=x;const s=()=>{const f=d.current;if(!f)return["",0];const b=f.selectionEnd,v=f.value.slice(0,b).match(/\S*$/)||{0:"",index:b},y=f.value.slice(b).match(/^\S*/)||{0:""};return[v[0]+y[0],v.index??b]},o=N.useRef([]);o.current=(()=>{const f=s()[0].slice(1).toLowerCase(),b=v=>v.startsWith(f)&&f.length<v.length;return g.current.filter(v=>b(v.toLowerCase())).slice(0,5)})();const a=N.useRef(!1);a.current=!!(i&&o.current.length>0);const l=f=>{if(!r||!("current"in r)||!r.current)return;const[b,v]=s();r.current.removeText(v,b.length),r.current.insertText(`#${f}`),m()},u=f=>{if(!a.current)return;const b=o.current,v=e.current;["Escape","ArrowLeft","ArrowRight"].includes(f.code)&&m(),f.code==="ArrowDown"&&(t((v+1)%b.length),f.preventDefault(),f.stopPropagation()),f.code==="ArrowUp"&&(t((v-1+b.length)%b.length),f.preventDefault(),f.stopPropagation()),["Enter","Tab"].includes(f.code)&&(l(b[v]),f.preventDefault(),f.stopPropagation())},C=()=>{if(!d.current)return;t(0);const[f,b]=s();f.startsWith("#")&&!f.slice(1).includes("#")?c(yt(d.current,b)):m()},w=N.useRef(!1),R=()=>{const f=d.current;!f||w.current||(f.addEventListener("click",m),f.addEventListener("blur",m),f.addEventListener("keydown",u),f.addEventListener("input",C),w.current=!0)};return N.useEffect(R,[!!d.current]),!a.current||!i?null:n.jsx("div",{className:"tag-suggestions z-20 p-1 absolute max-w-[12rem] rounded font-mono shadow bg-zinc-200 dark:bg-zinc-600",style:{left:i.left,top:i.top+i.height},children:o.current.map((f,b)=>n.jsxs("div",{onMouseDown:()=>l(f),className:Ce("rounded p-1 px-2 w-full truncate text-sm dark:text-gray-300 cursor-pointer hover:bg-zinc-300 dark:hover:bg-zinc-700",b===x?"bg-zinc-300 dark:bg-zinc-700":""),children:["#",f]},f))})};const Mt=N.forwardRef(function(r,i){var a;const{className:c,initialContent:m,placeholder:h,fullscreen:g,onPaste:x,onContentChange:t}=r,e=N.useRef(null);N.useEffect(()=>{e.current&&m&&(e.current.value=m,t(m))},[]),N.useEffect(()=>{e.current&&!g&&s()},[(a=e.current)==null?void 0:a.value,g]);const s=()=>{e.current&&(e.current.style.height="auto",e.current.style.height=(e.current.scrollHeight??0)+"px")};N.useImperativeHandle(i,()=>({focus:()=>{var l;(l=e.current)==null||l.focus()},scrollToCursor:()=>{e.current&&(e.current.scrollTop=e.current.scrollHeight)},insertText:(l="",u="",C="")=>{if(!e.current)return;const w=e.current.selectionStart,R=e.current.selectionEnd,f=e.current.value,b=f.slice(0,w)+u+(l||f.slice(w,R))+C+f.slice(R);e.current.value=b,e.current.focus(),e.current.selectionEnd=R+u.length+l.length,t(e.current.value),s()},removeText:(l,u)=>{if(!e.current)return;const C=e.current.value,w=C.slice(0,l)+C.slice(l+u);e.current.value=w,e.current.focus(),e.current.selectionEnd=l,t(e.current.value),s()},setContent:l=>{e.current&&(e.current.value=l,e.current.focus(),t(e.current.value),s())},getContent:()=>{var l;return((l=e.current)==null?void 0:l.value)??""},getCursorPosition:()=>{var l;return((l=e.current)==null?void 0:l.selectionStart)??0},getSelectedContent:()=>{var C,w,R;const l=(C=e.current)==null?void 0:C.selectionStart,u=(w=e.current)==null?void 0:w.selectionEnd;return((R=e.current)==null?void 0:R.value.slice(l,u))??""},setCursorPosition:(l,u)=>{var w;const C=isNaN(u)?l:u;(w=e.current)==null||w.setSelectionRange(l,C)}}),[]);const o=N.useCallback(()=>{var l;t(((l=e.current)==null?void 0:l.value)??""),s()},[]);return n.jsxs("div",{className:"common-editor-wrapper "+c,children:[n.jsx("textarea",{className:"common-editor-inputer",rows:1,placeholder:h,ref:e,onPaste:x,onInput:o}),n.jsx(Et,{editorRef:e,editorActions:i})]})}),jt=d=>{const{relationList:r,setRelationList:i}=d,c=be(),[m,h]=N.useState([]);N.useEffect(()=>{(async()=>{const t=r.map(async s=>{const o=await c.getOrFetchMemoById(s.relatedMemoId);return{...s,relatedMemo:o}}),e=await Promise.all(t);h(e)})()},[r]);const g=async x=>{const t=r.filter(e=>e.relatedMemoId!==x.relatedMemoId);i(t)};return n.jsx(n.Fragment,{children:m.length>0&&n.jsx("div",{className:"w-full flex flex-row gap-2 mt-2 flex-wrap",children:m.map(x=>n.jsxs("div",{className:"w-auto max-w-[50%] overflow-hidden flex flex-row justify-start items-center bg-gray-100 dark:bg-zinc-800 hover:opacity-80 rounded text-sm p-1 px-2 text-gray-500 cursor-pointer",children:[n.jsx(j.Link,{className:"w-4 h-auto shrink-0"}),n.jsx("span",{className:"mx-1 max-w-full text-ellipsis font-mono whitespace-nowrap overflow-hidden",children:x.relatedMemo.content}),n.jsx(j.X,{className:"w-4 h-auto hover:opacity-80 shrink-0",onClick:()=>g(x)})]},x.relatedMemoId))})})},St=d=>{const{className:r,resource:i}=d;if(Xe(i).startsWith("image")){const m=Ge(i);return n.jsx(Ke,{className:Ce("cursor-pointer rounded hover:shadow",r),children:n.jsx("img",{className:"min-h-full min-w-full w-auto h-auto rounded",src:i.externalLink?m:m+"?thumbnail=1",onClick:()=>Ne([m],0),decoding:"async",loading:"lazy"})},i.id)}const c=j.FileText;return n.jsx(c,{className:r})},Rt=d=>{const{resourceList:r,setResourceList:i}=d,c=async m=>{i(r.filter(h=>h.id!==m))};return n.jsx(n.Fragment,{children:r.length>0&&n.jsx("div",{className:"w-full flex flex-row justify-start flex-wrap gap-2 mt-2",children:r.map(m=>n.jsxs("div",{className:"max-w-full flex flex-row justify-start items-center flex-nowrap bg-gray-100 dark:bg-zinc-800 px-2 py-1 rounded text-gray-500",children:[n.jsx(St,{resource:m,className:"w-4 h-auto mr-1"}),n.jsx("span",{className:"text-sm max-w-xs truncate",children:m.filename}),n.jsx(j.X,{className:"w-4 h-auto ml-1 cursor-pointer hover:opacity-80",onClick:()=>c(m.id)})]},m.id))})})};const fe=["- [ ] ","- [x] ","- [X] ","* ","- "],kt=/^(\d+)\. $/,Lt=d=>{const{className:r,memoId:i,onConfirm:c}=d,{i18n:m}=ve(),h=z(),{state:{systemStatus:g}}=xe(),x=Z(),t=ye(),e=ee(),s=te(),o=qe(),[a,l]=N.useState({memoVisibility:"PRIVATE",resourceList:[],relationList:d.relationList??[],fullscreen:!1,isUploadingResource:!1,isRequesting:!1}),[u,C]=N.useState(!1),[w,R]=N.useState(!1),f=N.useRef(null),v=x.state.user.setting;N.useEffect(()=>{let p=v.memoVisibility;g.disablePublicMemos&&p==="PUBLIC"&&(p="PRIVATE"),l(E=>({...E,memoVisibility:p}))},[v.memoVisibility,g.disablePublicMemos]),N.useEffect(()=>{i&&e.getMemoById(i??K).then(p=>{var E;p&&(oe(),l(S=>({...S,memoVisibility:p.visibility,resourceList:p.resourceList,relationList:p.relationList})),(E=f.current)==null||E.setContent(p.content??""))})},[i]);const y=p=>{var S;if(!f.current)return;if((p.ctrlKey||p.metaKey)&&p.key==="Enter"){$();return}if(p.key==="Enter"&&!w){const L=f.current.getCursorPosition(),A=f.current.getContent().slice(0,L),M=Ze(A.split(`
`));if(M)if(fe.includes(M)||kt.test(M))p.preventDefault(),f.current.removeText(L-M.length,M.length);else{let Y=!1;for(const H of fe)if(M.startsWith(H)){p.preventDefault(),f.current.insertText("",`
${H}`),Y=!0;break}if(!Y){const H=/^(\d+)\. /.exec(M);if(H){const ae=parseInt(H[1]);ft(ae)&&(p.preventDefault(),f.current.insertText("",`
${ae+1}. `))}}(S=f.current)==null||S.scrollToCursor()}return}if(p.key==="Escape"){a.fullscreen&&F();return}if(p.key==="Tab"){p.preventDefault();const L=" ".repeat(ce),A=f.current.getCursorPosition(),M=f.current.getSelectedContent();f.current.insertText(L),M&&f.current.setCursorPosition(A+ce);return}},T=p=>{l(E=>({...E,memoVisibility:p}))},se=()=>{Je({onConfirm:p=>{l(E=>({...E,resourceList:[...E.resourceList,...p]}))}})},ne=p=>{l(E=>({...E,resourceList:p}))},k=p=>{l(E=>({...E,relationList:p}))},I=async p=>{l(S=>({...S,isUploadingResource:!0}));let E;try{E=await o.createResourceWithBlob(p)}catch(S){console.error(S),_.error(typeof S=="string"?S:S.response.data.message)}return l(S=>({...S,isUploadingResource:!1})),E},D=async p=>{const E=[];for(const S of p){const L=await I(S);L&&(E.push(L),i&&await st(i,L.id))}E.length>0&&l(S=>({...S,resourceList:[...S.resourceList,...E]}))},W=async p=>{p.dataTransfer&&p.dataTransfer.files.length>0&&(p.preventDefault(),await D(p.dataTransfer.files))},P=async p=>{p.clipboardData&&p.clipboardData.files.length>0&&(p.preventDefault(),await D(p.clipboardData.files))},U=p=>{C(p!=="")},$=async()=>{var L,A;if(a.isRequesting)return;l(M=>({...M,isRequesting:!0}));const p=((L=f.current)==null?void 0:L.getContent())??"";try{if(i&&i!==K){const M=await e.getMemoById(i??K);M&&await e.patchMemo({id:M.id,content:p,visibility:a.memoVisibility,resourceIdList:a.resourceList.map(Y=>Y.id),relationList:a.relationList})}else await e.createMemo({content:p,visibility:a.memoVisibility,resourceIdList:a.resourceList.map(M=>M.id),relationList:a.relationList}),t.clearFilter()}catch(M){console.error(M),_.error(M.response.data.message)}l(M=>({...M,isRequesting:!1}));const E=et(p),S=gt(E.filter(M=>M.parserName==="tag").map(M=>M.matchedContent.slice(1)));for(const M of S)await s.upsertTag(M);l(M=>({...M,fullscreen:!1})),l(M=>({...M,resourceList:[],relationList:[]})),(A=f.current)==null||A.setContent(""),tt(),c&&c()},re=()=>{var S,L,A;if(!f.current)return;const p=f.current.getCursorPosition(),E=f.current.getContent().slice(0,p);E===""||E.endsWith(`
`)?(S=f.current)==null||S.insertText("","- [ ] "):(L=f.current)==null||L.insertText("",`
- [ ] `),(A=f.current)==null||A.scrollToCursor()},V=()=>{var S,L,A;if(!f.current)return;const p=f.current.getCursorPosition(),E=f.current.getContent().slice(0,p);E===""||E.endsWith(`
`)?(S=f.current)==null||S.insertText("","```\n","\n```"):(L=f.current)==null||L.insertText("","\n```\n","\n```"),(A=f.current)==null||A.scrollToCursor()},F=N.useCallback(()=>{l(p=>({...p,fullscreen:!p.fullscreen}))},[]),B=N.useCallback(p=>{var E;(E=f.current)==null||E.insertText(`#${p} `)},[]),oe=()=>{var p;(p=f.current)==null||p.focus()},Te=N.useMemo(()=>({className:"memo-editor",initialContent:"",placeholder:h("editor.placeholder"),fullscreen:a.fullscreen,onContentChange:U,onPaste:P}),[a.fullscreen,m.language]),Pe=(u||a.resourceList.length>0)&&!a.isUploadingResource&&!a.isRequesting;return n.jsxs("div",{className:`${r??""} memo-editor-container ${a.fullscreen?"fullscreen":""}`,tabIndex:0,onKeyDown:y,onDrop:W,onFocus:oe,onCompositionStart:()=>R(!0),onCompositionEnd:()=>R(!1),children:[n.jsx(Mt,{ref:f,...Te}),n.jsx("div",{className:"common-tools-wrapper",children:n.jsxs("div",{className:"common-tools-container",children:[n.jsx(Nt,{onTagSelectorClick:p=>B(p)}),n.jsx("button",{className:"action-btn",children:n.jsx(j.CheckSquare,{className:"icon-img",onClick:re})}),n.jsx("button",{className:"action-btn",children:n.jsx(j.Code,{className:"icon-img",onClick:V})}),n.jsx("button",{className:"action-btn",children:n.jsx(j.Image,{className:"icon-img",onClick:se})}),n.jsx("button",{className:"action-btn",onClick:F,children:a.fullscreen?n.jsx(j.Minimize,{className:"icon-img"}):n.jsx(j.Maximize,{className:"icon-img"})})]})}),n.jsx(Rt,{resourceList:a.resourceList,setResourceList:ne}),n.jsx(jt,{relationList:a.relationList,setRelationList:k}),n.jsxs("div",{className:"editor-footer-container",children:[n.jsx(bt,{value:a.memoVisibility,onChange:T}),n.jsx("div",{className:"buttons-container",children:n.jsx("button",{className:"action-btn confirm-btn",disabled:!Pe,onClick:$,children:h("editor.save")})})]})]})},It=({memoId:d,relationList:r,destroy:i})=>{const c=z(),m=te();N.useEffect(()=>{m.fetchTags()},[]);const h=()=>{i()};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"dialog-header-container",children:[n.jsx("p",{className:"title-text flex items-center",children:c("amount-text.memo_one")}),n.jsx("button",{className:"btn close-btn",onClick:h,children:n.jsx(j.X,{})})]}),n.jsx("div",{className:"flex flex-col justify-start items-start max-w-full w-[36rem]",children:n.jsx(Lt,{memoId:d,relationList:r,onConfirm:h})})]})};function ge(d={}){J({className:"memo-editor-dialog",dialogName:"memo-editor-dialog"},It,d)}const Tt=d=>{const r=be(),[i,c]=N.useState([]),m=d.relationList;N.useEffect(()=>{(async()=>{const x=await Promise.all(m.map(t=>r.getOrFetchMemoById(t.relatedMemoId)));c(x)})()},[m]);const h=g=>{window.open(`/m/${g.id}`,"_blank")};return n.jsx(n.Fragment,{children:i.length>0&&n.jsx("div",{className:"w-full max-w-full overflow-hidden grid grid-cols-1 gap-1 mt-2",children:i.map(g=>n.jsxs("div",{className:"w-auto flex flex-row justify-start items-center hover:bg-gray-100 dark:hover:bg-zinc-800 rounded text-sm p-1 text-gray-500 dark:text-gray-400 cursor-pointer",onClick:()=>h(g),children:[n.jsx("div",{className:"w-5 h-5 flex justify-center items-center shrink-0 bg-gray-100 dark:bg-zinc-800 rounded-full",children:n.jsx(j.Link,{className:"w-3 h-auto"})}),n.jsx("span",{className:"mx-1 w-auto truncate",children:g.content})]},g.id))})})};var Pt=Object.defineProperty,q=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable,pe=(d,r,i)=>r in d?Pt(d,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[r]=i,At=(d,r)=>{for(var i in r||(r={}))ke.call(r,i)&&pe(d,i,r[i]);if(q)for(var i of q(r))Le.call(r,i)&&pe(d,i,r[i]);return d},Dt=(d,r)=>{var i={};for(var c in d)ke.call(d,c)&&r.indexOf(c)<0&&(i[c]=d[c]);if(d!=null&&q)for(var c of q(d))r.indexOf(c)<0&&Le.call(d,c)&&(i[c]=d[c]);return i};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var O;(d=>{const r=class{constructor(t,e,s,o){if(this.version=t,this.errorCorrectionLevel=e,this.modules=[],this.isFunction=[],t<r.MIN_VERSION||t>r.MAX_VERSION)throw new RangeError("Version value out of range");if(o<-1||o>7)throw new RangeError("Mask value out of range");this.size=t*4+17;let a=[];for(let u=0;u<this.size;u++)a.push(!1);for(let u=0;u<this.size;u++)this.modules.push(a.slice()),this.isFunction.push(a.slice());this.drawFunctionPatterns();const l=this.addEccAndInterleave(s);if(this.drawCodewords(l),o==-1){let u=1e9;for(let C=0;C<8;C++){this.applyMask(C),this.drawFormatBits(C);const w=this.getPenaltyScore();w<u&&(o=C,u=w),this.applyMask(C)}}h(0<=o&&o<=7),this.mask=o,this.applyMask(o),this.drawFormatBits(o),this.isFunction=[]}static encodeText(t,e){const s=d.QrSegment.makeSegments(t);return r.encodeSegments(s,e)}static encodeBinary(t,e){const s=d.QrSegment.makeBytes(t);return r.encodeSegments([s],e)}static encodeSegments(t,e,s=1,o=40,a=-1,l=!0){if(!(r.MIN_VERSION<=s&&s<=o&&o<=r.MAX_VERSION)||a<-1||a>7)throw new RangeError("Invalid value");let u,C;for(u=s;;u++){const b=r.getNumDataCodewords(u,e)*8,v=x.getTotalBits(t,u);if(v<=b){C=v;break}if(u>=o)throw new RangeError("Data too long")}for(const b of[r.Ecc.MEDIUM,r.Ecc.QUARTILE,r.Ecc.HIGH])l&&C<=r.getNumDataCodewords(u,b)*8&&(e=b);let w=[];for(const b of t){c(b.mode.modeBits,4,w),c(b.numChars,b.mode.numCharCountBits(u),w);for(const v of b.getData())w.push(v)}h(w.length==C);const R=r.getNumDataCodewords(u,e)*8;h(w.length<=R),c(0,Math.min(4,R-w.length),w),c(0,(8-w.length%8)%8,w),h(w.length%8==0);for(let b=236;w.length<R;b^=253)c(b,8,w);let f=[];for(;f.length*8<w.length;)f.push(0);return w.forEach((b,v)=>f[v>>>3]|=b<<7-(v&7)),new r(u,e,f,a)}getModule(t,e){return 0<=t&&t<this.size&&0<=e&&e<this.size&&this.modules[e][t]}getModules(){return this.modules}drawFunctionPatterns(){for(let s=0;s<this.size;s++)this.setFunctionModule(6,s,s%2==0),this.setFunctionModule(s,6,s%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const t=this.getAlignmentPatternPositions(),e=t.length;for(let s=0;s<e;s++)for(let o=0;o<e;o++)s==0&&o==0||s==0&&o==e-1||s==e-1&&o==0||this.drawAlignmentPattern(t[s],t[o]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(t){const e=this.errorCorrectionLevel.formatBits<<3|t;let s=e;for(let a=0;a<10;a++)s=s<<1^(s>>>9)*1335;const o=(e<<10|s)^21522;h(o>>>15==0);for(let a=0;a<=5;a++)this.setFunctionModule(8,a,m(o,a));this.setFunctionModule(8,7,m(o,6)),this.setFunctionModule(8,8,m(o,7)),this.setFunctionModule(7,8,m(o,8));for(let a=9;a<15;a++)this.setFunctionModule(14-a,8,m(o,a));for(let a=0;a<8;a++)this.setFunctionModule(this.size-1-a,8,m(o,a));for(let a=8;a<15;a++)this.setFunctionModule(8,this.size-15+a,m(o,a));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let t=this.version;for(let s=0;s<12;s++)t=t<<1^(t>>>11)*7973;const e=this.version<<12|t;h(e>>>18==0);for(let s=0;s<18;s++){const o=m(e,s),a=this.size-11+s%3,l=Math.floor(s/3);this.setFunctionModule(a,l,o),this.setFunctionModule(l,a,o)}}drawFinderPattern(t,e){for(let s=-4;s<=4;s++)for(let o=-4;o<=4;o++){const a=Math.max(Math.abs(o),Math.abs(s)),l=t+o,u=e+s;0<=l&&l<this.size&&0<=u&&u<this.size&&this.setFunctionModule(l,u,a!=2&&a!=4)}}drawAlignmentPattern(t,e){for(let s=-2;s<=2;s++)for(let o=-2;o<=2;o++)this.setFunctionModule(t+o,e+s,Math.max(Math.abs(o),Math.abs(s))!=1)}setFunctionModule(t,e,s){this.modules[e][t]=s,this.isFunction[e][t]=!0}addEccAndInterleave(t){const e=this.version,s=this.errorCorrectionLevel;if(t.length!=r.getNumDataCodewords(e,s))throw new RangeError("Invalid argument");const o=r.NUM_ERROR_CORRECTION_BLOCKS[s.ordinal][e],a=r.ECC_CODEWORDS_PER_BLOCK[s.ordinal][e],l=Math.floor(r.getNumRawDataModules(e)/8),u=o-l%o,C=Math.floor(l/o);let w=[];const R=r.reedSolomonComputeDivisor(a);for(let b=0,v=0;b<o;b++){let y=t.slice(v,v+C-a+(b<u?0:1));v+=y.length;const T=r.reedSolomonComputeRemainder(y,R);b<u&&y.push(0),w.push(y.concat(T))}let f=[];for(let b=0;b<w[0].length;b++)w.forEach((v,y)=>{(b!=C-a||y>=u)&&f.push(v[b])});return h(f.length==l),f}drawCodewords(t){if(t.length!=Math.floor(r.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let e=0;for(let s=this.size-1;s>=1;s-=2){s==6&&(s=5);for(let o=0;o<this.size;o++)for(let a=0;a<2;a++){const l=s-a,C=(s+1&2)==0?this.size-1-o:o;!this.isFunction[C][l]&&e<t.length*8&&(this.modules[C][l]=m(t[e>>>3],7-(e&7)),e++)}}h(e==t.length*8)}applyMask(t){if(t<0||t>7)throw new RangeError("Mask value out of range");for(let e=0;e<this.size;e++)for(let s=0;s<this.size;s++){let o;switch(t){case 0:o=(s+e)%2==0;break;case 1:o=e%2==0;break;case 2:o=s%3==0;break;case 3:o=(s+e)%3==0;break;case 4:o=(Math.floor(s/3)+Math.floor(e/2))%2==0;break;case 5:o=s*e%2+s*e%3==0;break;case 6:o=(s*e%2+s*e%3)%2==0;break;case 7:o=((s+e)%2+s*e%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[e][s]&&o&&(this.modules[e][s]=!this.modules[e][s])}}getPenaltyScore(){let t=0;for(let a=0;a<this.size;a++){let l=!1,u=0,C=[0,0,0,0,0,0,0];for(let w=0;w<this.size;w++)this.modules[a][w]==l?(u++,u==5?t+=r.PENALTY_N1:u>5&&t++):(this.finderPenaltyAddHistory(u,C),l||(t+=this.finderPenaltyCountPatterns(C)*r.PENALTY_N3),l=this.modules[a][w],u=1);t+=this.finderPenaltyTerminateAndCount(l,u,C)*r.PENALTY_N3}for(let a=0;a<this.size;a++){let l=!1,u=0,C=[0,0,0,0,0,0,0];for(let w=0;w<this.size;w++)this.modules[w][a]==l?(u++,u==5?t+=r.PENALTY_N1:u>5&&t++):(this.finderPenaltyAddHistory(u,C),l||(t+=this.finderPenaltyCountPatterns(C)*r.PENALTY_N3),l=this.modules[w][a],u=1);t+=this.finderPenaltyTerminateAndCount(l,u,C)*r.PENALTY_N3}for(let a=0;a<this.size-1;a++)for(let l=0;l<this.size-1;l++){const u=this.modules[a][l];u==this.modules[a][l+1]&&u==this.modules[a+1][l]&&u==this.modules[a+1][l+1]&&(t+=r.PENALTY_N2)}let e=0;for(const a of this.modules)e=a.reduce((l,u)=>l+(u?1:0),e);const s=this.size*this.size,o=Math.ceil(Math.abs(e*20-s*10)/s)-1;return h(0<=o&&o<=9),t+=o*r.PENALTY_N4,h(0<=t&&t<=2568888),t}getAlignmentPatternPositions(){if(this.version==1)return[];{const t=Math.floor(this.version/7)+2,e=this.version==32?26:Math.ceil((this.version*4+4)/(t*2-2))*2;let s=[6];for(let o=this.size-7;s.length<t;o-=e)s.splice(1,0,o);return s}}static getNumRawDataModules(t){if(t<r.MIN_VERSION||t>r.MAX_VERSION)throw new RangeError("Version number out of range");let e=(16*t+128)*t+64;if(t>=2){const s=Math.floor(t/7)+2;e-=(25*s-10)*s-55,t>=7&&(e-=36)}return h(208<=e&&e<=29648),e}static getNumDataCodewords(t,e){return Math.floor(r.getNumRawDataModules(t)/8)-r.ECC_CODEWORDS_PER_BLOCK[e.ordinal][t]*r.NUM_ERROR_CORRECTION_BLOCKS[e.ordinal][t]}static reedSolomonComputeDivisor(t){if(t<1||t>255)throw new RangeError("Degree out of range");let e=[];for(let o=0;o<t-1;o++)e.push(0);e.push(1);let s=1;for(let o=0;o<t;o++){for(let a=0;a<e.length;a++)e[a]=r.reedSolomonMultiply(e[a],s),a+1<e.length&&(e[a]^=e[a+1]);s=r.reedSolomonMultiply(s,2)}return e}static reedSolomonComputeRemainder(t,e){let s=e.map(o=>0);for(const o of t){const a=o^s.shift();s.push(0),e.forEach((l,u)=>s[u]^=r.reedSolomonMultiply(l,a))}return s}static reedSolomonMultiply(t,e){if(t>>>8||e>>>8)throw new RangeError("Byte out of range");let s=0;for(let o=7;o>=0;o--)s=s<<1^(s>>>7)*285,s^=(e>>>o&1)*t;return h(s>>>8==0),s}finderPenaltyCountPatterns(t){const e=t[1];h(e<=this.size*3);const s=e>0&&t[2]==e&&t[3]==e*3&&t[4]==e&&t[5]==e;return(s&&t[0]>=e*4&&t[6]>=e?1:0)+(s&&t[6]>=e*4&&t[0]>=e?1:0)}finderPenaltyTerminateAndCount(t,e,s){return t&&(this.finderPenaltyAddHistory(e,s),e=0),e+=this.size,this.finderPenaltyAddHistory(e,s),this.finderPenaltyCountPatterns(s)}finderPenaltyAddHistory(t,e){e[0]==0&&(t+=this.size),e.pop(),e.unshift(t)}};let i=r;i.MIN_VERSION=1,i.MAX_VERSION=40,i.PENALTY_N1=3,i.PENALTY_N2=3,i.PENALTY_N3=40,i.PENALTY_N4=10,i.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],i.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],d.QrCode=i;function c(t,e,s){if(e<0||e>31||t>>>e)throw new RangeError("Value out of range");for(let o=e-1;o>=0;o--)s.push(t>>>o&1)}function m(t,e){return(t>>>e&1)!=0}function h(t){if(!t)throw new Error("Assertion error")}const g=class{constructor(t,e,s){if(this.mode=t,this.numChars=e,this.bitData=s,e<0)throw new RangeError("Invalid argument");this.bitData=s.slice()}static makeBytes(t){let e=[];for(const s of t)c(s,8,e);return new g(g.Mode.BYTE,t.length,e)}static makeNumeric(t){if(!g.isNumeric(t))throw new RangeError("String contains non-numeric characters");let e=[];for(let s=0;s<t.length;){const o=Math.min(t.length-s,3);c(parseInt(t.substr(s,o),10),o*3+1,e),s+=o}return new g(g.Mode.NUMERIC,t.length,e)}static makeAlphanumeric(t){if(!g.isAlphanumeric(t))throw new RangeError("String contains unencodable characters in alphanumeric mode");let e=[],s;for(s=0;s+2<=t.length;s+=2){let o=g.ALPHANUMERIC_CHARSET.indexOf(t.charAt(s))*45;o+=g.ALPHANUMERIC_CHARSET.indexOf(t.charAt(s+1)),c(o,11,e)}return s<t.length&&c(g.ALPHANUMERIC_CHARSET.indexOf(t.charAt(s)),6,e),new g(g.Mode.ALPHANUMERIC,t.length,e)}static makeSegments(t){return t==""?[]:g.isNumeric(t)?[g.makeNumeric(t)]:g.isAlphanumeric(t)?[g.makeAlphanumeric(t)]:[g.makeBytes(g.toUtf8ByteArray(t))]}static makeEci(t){let e=[];if(t<0)throw new RangeError("ECI assignment value out of range");if(t<128)c(t,8,e);else if(t<16384)c(2,2,e),c(t,14,e);else if(t<1e6)c(6,3,e),c(t,21,e);else throw new RangeError("ECI assignment value out of range");return new g(g.Mode.ECI,0,e)}static isNumeric(t){return g.NUMERIC_REGEX.test(t)}static isAlphanumeric(t){return g.ALPHANUMERIC_REGEX.test(t)}getData(){return this.bitData.slice()}static getTotalBits(t,e){let s=0;for(const o of t){const a=o.mode.numCharCountBits(e);if(o.numChars>=1<<a)return 1/0;s+=4+a+o.bitData.length}return s}static toUtf8ByteArray(t){t=encodeURI(t);let e=[];for(let s=0;s<t.length;s++)t.charAt(s)!="%"?e.push(t.charCodeAt(s)):(e.push(parseInt(t.substr(s+1,2),16)),s+=2);return e}};let x=g;x.NUMERIC_REGEX=/^[0-9]*$/,x.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,x.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",d.QrSegment=x})(O||(O={}));(d=>{(r=>{const i=class{constructor(m,h){this.ordinal=m,this.formatBits=h}};let c=i;c.LOW=new i(0,1),c.MEDIUM=new i(1,0),c.QUARTILE=new i(2,3),c.HIGH=new i(3,2),r.Ecc=c})(d.QrCode||(d.QrCode={}))})(O||(O={}));(d=>{(r=>{const i=class{constructor(m,h){this.modeBits=m,this.numBitsCharCount=h}numCharCountBits(m){return this.numBitsCharCount[Math.floor((m+7)/17)]}};let c=i;c.NUMERIC=new i(1,[10,12,14]),c.ALPHANUMERIC=new i(2,[9,11,13]),c.BYTE=new i(4,[8,16,16]),c.KANJI=new i(8,[8,10,12]),c.ECI=new i(7,[0,0,0]),r.Mode=c})(d.QrSegment||(d.QrSegment={}))})(O||(O={}));var Q=O;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var _t={L:Q.QrCode.Ecc.LOW,M:Q.QrCode.Ecc.MEDIUM,Q:Q.QrCode.Ecc.QUARTILE,H:Q.QrCode.Ecc.HIGH},Ft=128,Bt="L",zt="#FFFFFF",Ot="#000000",Ut=!1,Ie=4,$t=.1;function Vt(d,r=0){const i=[];return d.forEach(function(c,m){let h=null;c.forEach(function(g,x){if(!g&&h!==null){i.push(`M${h+r} ${m+r}h${x-h}v1H${h+r}z`),h=null;return}if(x===c.length-1){if(!g)return;h===null?i.push(`M${x+r},${m+r} h1v1H${x+r}z`):i.push(`M${h+r},${m+r} h${x+1-h}v1H${h+r}z`);return}g&&h===null&&(h=x)})}),i.join("")}function Ht(d,r){return d.slice().map((i,c)=>c<r.y||c>=r.y+r.h?i:i.map((m,h)=>h<r.x||h>=r.x+r.w?m:!1))}function Qt(d,r,i,c){if(c==null)return null;const m=i?Ie:0,h=d.length+m*2,g=Math.floor(r*$t),x=h/r,t=(c.width||g)*x,e=(c.height||g)*x,s=c.x==null?d.length/2-t/2:c.x*x,o=c.y==null?d.length/2-e/2:c.y*x;let a=null;if(c.excavate){let l=Math.floor(s),u=Math.floor(o),C=Math.ceil(t+s-l),w=Math.ceil(e+o-u);a={x:l,y:u,w:C,h:w}}return{x:s,y:o,h:e,w:t,excavation:a}}(function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0})();function Wt(d){const r=d,{value:i,size:c=Ft,level:m=Bt,bgColor:h=zt,fgColor:g=Ot,includeMargin:x=Ut,imageSettings:t}=r,e=Dt(r,["value","size","level","bgColor","fgColor","includeMargin","imageSettings"]);let s=Q.QrCode.encodeText(i,_t[m]).getModules();const o=x?Ie:0,a=s.length+o*2,l=Qt(s,c,x,t);let u=null;t!=null&&l!=null&&(l.excavation!=null&&(s=Ht(s,l.excavation)),u=G.createElement("image",{xlinkHref:t.src,height:l.h,width:l.w,x:l.x+o,y:l.y+o,preserveAspectRatio:"none"}));const C=Vt(s,o);return G.createElement("svg",At({height:c,width:c,viewBox:`0 0 ${a} ${a}`},e),G.createElement("path",{fill:h,d:`M0,0 h${a}v${a}H0z`,shapeRendering:"crispEdges"}),G.createElement("path",{fill:g,d:C,shapeRendering:"crispEdges"}),u)}const Yt=d=>{const r=z(),{memoId:i,destroy:c}=d,m=()=>`<iframe style="width:100%;height:auto;min-width:256px;" src="${window.location.origin}/m/${i}/embed" frameBorder="0"></iframe>`,h=()=>{Ee(m()),_.success("Succeed to copy code to clipboard.")};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"dialog-header-container",children:[n.jsx("p",{className:"title-text",children:r("embed-memo.title")}),n.jsx("button",{className:"btn close-btn",onClick:()=>c(),children:n.jsx(j.X,{})})]}),n.jsxs("div",{className:"dialog-content-container !w-80",children:[n.jsx("p",{className:"text-base leading-6 mb-2",children:r("embed-memo.text")}),n.jsx("pre",{className:"w-full font-mono text-sm p-3 border rounded-lg",children:n.jsx("code",{className:"w-full break-all whitespace-pre-wrap",children:m()})}),n.jsxs("p",{className:"w-full text-sm leading-6 flex flex-row justify-between items-center mt-2",children:[n.jsx("span",{className:"italic opacity-80",children:r("embed-memo.only-public-supported")}),n.jsx("span",{className:"btn-primary",onClick:h,children:r("embed-memo.copy")})]})]})]})};function Xt(d){J({className:"embed-memo-dialog",dialogName:"embed-memo-dialog"},Yt,{memoId:d})}const Gt=d=>{const{memo:r,destroy:i}=d,c=z(),m=Z(),h=ee(),g=m.state.user,[x,t]=N.useState({memoAmount:0,memoVisibility:r.visibility,showQRCode:!0}),e=ue(!1),s=ue(),o=N.useRef(null),a={...r,displayTsStr:de(r.displayTs)},l=Math.ceil((Date.now()-nt(g.createdTs))/1e3/3600/24);N.useEffect(()=>{rt(g.username).then(({data:y})=>{u({memoAmount:y.length}),s.setFinish()}).catch(y=>{console.error(y)})},[]);const u=y=>{t({...x,...y})},C=()=>{i()},w=()=>{o.current&&(e.setLoading(),it(o.current,{pixelRatio:window.devicePixelRatio*2}).then(y=>{const T=document.createElement("a");T.href=y,T.download=`memos-${de(Date.now())}.png`,T.click(),e.setFinish()}).catch(y=>{console.error(y)}))},R=()=>{Xt(a.id)},f=()=>{Ee(`${window.location.origin}/m/${a.id}`),_.success(c("message.succeed-copy-link"))},b=we.map(y=>({value:y.value,text:c(`memo.visibility.${Se(y.value)}`)})),v=async y=>{const T=y;u({memoVisibility:T}),await h.patchMemo({id:a.id,visibility:T})};return n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"dialog-header-container py-3 px-4 !mb-0 rounded-t-lg",children:[n.jsxs("p",{className:"",children:[c("common.share")," Memo"]}),n.jsx("button",{className:"btn close-btn",onClick:C,children:n.jsx(j.X,{className:"icon-img"})})]}),n.jsxs("div",{className:"dialog-content-container w-full flex flex-col justify-start items-start relative",children:[n.jsxs("div",{className:"px-4 pb-3 w-full flex flex-row justify-start items-center",children:[n.jsxs("span",{className:"text-sm mr-2",children:[c("common.visibility"),":"]}),n.jsx(ot,{className:"!min-w-[10rem] w-auto text-sm",value:x.memoVisibility,onChange:(y,T)=>{T&&v(T)},children:b.map(y=>n.jsx(at,{value:y.value,className:"whitespace-nowrap",children:y.text},y.value))})]}),n.jsxs("div",{className:"px-4 pb-3 w-full flex flex-row justify-start items-center space-x-2",children:[n.jsxs("button",{disabled:e.isLoading,className:"btn-normal h-8",onClick:w,children:[e.isLoading?n.jsx(j.Loader,{className:"w-4 h-auto mr-1 animate-spin"}):n.jsx(j.Download,{className:"w-4 h-auto mr-1"}),c("common.image")]}),n.jsxs("button",{className:"btn-normal h-8",onClick:R,children:[n.jsx(j.Code,{className:"w-4 h-auto mr-1"}),c("memo.embed")]}),n.jsxs("button",{className:"btn-normal h-8",onClick:f,children:[n.jsx(j.Link,{className:"w-4 h-auto mr-1"}),c("common.link")]})]}),n.jsx("div",{className:"w-full rounded-lg border-t overflow-clip",children:n.jsxs("div",{className:"w-full h-auto select-none relative flex flex-col justify-start items-start bg-white dark:bg-zinc-800",ref:o,children:[n.jsx("span",{className:"w-full px-6 pt-5 pb-2 text-sm text-gray-500",children:a.displayTsStr}),n.jsxs("div",{className:"w-full px-6 text-base pb-4",children:[n.jsx(Me,{content:a.content}),n.jsx(je,{className:"!grid-cols-2",resourceList:a.resourceList})]}),n.jsxs("div",{className:"flex flex-row justify-between items-center w-full bg-gray-100 dark:bg-zinc-700 py-4 px-6",children:[n.jsx("div",{className:"mr-2",children:n.jsx("img",{className:"h-10 w-auto rounded-lg",src:`${g.avatarUrl||"/logo.webp"}`,alt:""})}),n.jsxs("div",{className:"w-auto grow truncate flex mr-2 flex-col justify-center items-start",children:[n.jsx("span",{className:"w-full text-sm truncate font-bold text-gray-600 dark:text-gray-300",children:g.nickname||g.username}),n.jsxs("span",{className:"text-xs text-gray-400",children:[x.memoAmount," MEMOS / ",l," DAYS"]})]}),n.jsx(Wt,{value:`${window.location.origin}/m/${a.id}`,size:40,bgColor:"#F3F4F6",fgColor:"#4B5563",includeMargin:!1})]})]})})]})]})};function Kt(d){J({className:"share-memo-dialog",dialogName:"share-memo-dialog"},Gt,{memo:d})}const qt=d=>{const{memo:r,lazyRendering:i}=d,{i18n:c}=ve(),m=z(),h=ye(),g=Z(),x=ee(),t=lt(),[e,s]=N.useState(!i),[o,a]=N.useState(me(r.displayTs)),l=N.useRef(null),u=g.isVisitorMode()||g.getCurrentUsername()!==r.creatorUsername,C=t.getUserByUsername(r.creatorUsername);if(N.useEffect(()=>{t.getOrFetchUserByUsername(r.creatorUsername)},[r.creatorUsername]),N.useEffect(()=>{let k=-1;return Date.now()-r.displayTs<1e3*60*60*24&&(k=setInterval(()=>{a(me(r.displayTs))},1e3*1)),()=>{clearInterval(k)}},[c.language]),N.useEffect(()=>{if(e)return;const k=document.body.querySelector("#root");if(k){const I=()=>{var D;if(k.scrollTop+window.innerHeight>(((D=l.current)==null?void 0:D.offsetTop)||0))return s(!0),k.removeEventListener("scroll",I),!0};if(I())return;k.addEventListener("scroll",I)}},[i,h.state]),!e)return n.jsx("div",{className:`memo-wrapper min-h-[128px] ${"memos-"+r.id}`,ref:l});const w=async()=>{try{r.pinned?await x.unpinMemo(r.id):await x.pinMemo(r.id)}catch{}},R=()=>{ge({memoId:r.id})},f=()=>{ge({relationList:[{memoId:K,relatedMemoId:r.id,type:"REFERENCE"}]})},b=async()=>{try{await x.patchMemo({id:r.id,rowStatus:"ARCHIVED"})}catch(k){console.error(k),_.error(k.response.data.message)}},v=async()=>{mt({title:m("memo.delete-memo"),content:m("memo.delete-confirm"),style:"warning",dialogName:"delete-memo-dialog",onConfirm:async()=>{await x.deleteMemoById(r.id)}})},y=()=>{Kt(r)},T=async k=>{var D,W;const I=k.target;if(I.className==="tag-span"){const P=I.innerText.slice(1);h.getState().tag===P?h.setTagFilter(void 0):h.setTagFilter(P)}else if(I.classList.contains("todo-block")){if(u)return;const P=(D=I.dataset)==null?void 0:D.value,U=[...((W=l.current)==null?void 0:W.querySelectorAll(`span.todo-block[data-value=${P}]`))??[]];for(const $ of U)if($===I){const re=U.indexOf($),V=r.content.split(P==="DONE"?/- \[x\] /:/- \[ \] /);let F="";for(let B=0;B<V.length;B++)B===0?F+=`${V[B]}`:(B===re+1?F+=P==="DONE"?"- [ ] ":"- [x] ":F+=P==="DONE"?"- [x] ":"- [ ] ",F+=`${V[B]}`);await x.patchMemo({id:r.id,content:F})}}else if(I.tagName==="IMG"){const P=I.getAttribute("src");P&&Ne([P],0)}},se=k=>{if(u)return;const I=g.state.user;if(I&&!I.localSetting.enableDoubleClickEditing)return;const D=k.target;D.className!=="tag-span"&&(D.classList.contains("todo-block")||R())},ne=k=>{k.altKey&&(k.preventDefault(),xt(r.id))};return n.jsx(n.Fragment,{children:n.jsxs("div",{className:`memo-wrapper ${"memos-"+r.id} ${r.pinned&&!u?"pinned":""}`,ref:l,children:[n.jsxs("div",{className:"memo-top-wrapper",children:[n.jsxs("p",{className:"w-full max-w-[calc(100%-20px)] flex flex-row justify-start items-center mr-1",children:[C&&n.jsxs(n.Fragment,{children:[n.jsxs(ct,{className:"flex flex-row justify-start items-center",to:`/u/${r.creatorUsername}`,children:[n.jsx(ut,{className:"!w-5 !h-auto mr-1",avatarUrl:C.avatarUrl}),n.jsx("span",{className:"text-sm text-gray-600 max-w-[8em] truncate dark:text-zinc-300",children:C.nickname})]}),n.jsx(j.Dot,{className:"w-4 h-auto text-gray-400 dark:text-zinc-400"})]}),n.jsx("span",{className:"text-sm text-gray-400",onClick:ne,children:o})]}),n.jsx("div",{className:"btns-container space-x-2",children:!u&&n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"btn more-action-btn",children:n.jsx(j.MoreVertical,{className:"icon-img"})}),n.jsx("div",{className:"more-action-btns-wrapper",children:n.jsxs("div",{className:"more-action-btns-container min-w-[6em]",children:[n.jsxs("span",{className:"btn",onClick:w,children:[r.pinned?n.jsx(j.BookmarkMinus,{className:"w-4 h-auto mr-2"}):n.jsx(j.BookmarkPlus,{className:"w-4 h-auto mr-2"}),r.pinned?m("common.unpin"):m("common.pin")]}),n.jsxs("span",{className:"btn",onClick:R,children:[n.jsx(j.Edit3,{className:"w-4 h-auto mr-2"}),m("common.edit")]}),n.jsxs("span",{className:"btn",onClick:y,children:[n.jsx(j.Share,{className:"w-4 h-auto mr-2"}),m("common.share")]}),n.jsxs("span",{className:"btn",onClick:f,children:[n.jsx(j.Link,{className:"w-4 h-auto mr-2"}),m("common.mark")]}),n.jsx(dt,{className:"!my-1"}),n.jsxs("span",{className:"btn text-orange-500",onClick:b,children:[n.jsx(j.Archive,{className:"w-4 h-auto mr-2"}),m("common.archive")]}),n.jsxs("span",{className:"btn text-red-600",onClick:v,children:[n.jsx(j.Trash,{className:"w-4 h-auto mr-2"}),m("common.delete")]})]})})]})})]}),n.jsx(Me,{content:r.content,onMemoContentClick:T,onMemoContentDoubleClick:se}),n.jsx(je,{resourceList:r.resourceList}),n.jsx(Tt,{relationList:r.relationList})]})})},Jt=N.memo(qt);export{Jt as M,Lt as a,te as u};
