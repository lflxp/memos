import{b as C,w as E,r as l,_ as P,j as t,I as v,a as K,C as W,k as q,B as A,F as G,G as V,n as L,H as J,d as I,x as X,J as H,K as Y,P as Z,Q as tt,R as et,S as z,f as st,u as at,M as nt,z as rt}from"./index-d6fbc60c.js";import{u as R,a as ot}from"./Memo-2db0b764.js";import{M as lt}from"./MemoList-15912e60.js";const ct=()=>{const n=C(),o=E(),[e,a]=l.useState(""),i=l.useRef(null);l.useEffect(()=>{const d=o.getState().text;a(d===void 0?"":d)},[o.state.text]),P(()=>{o.setTextFilter(e.length===0?void 0:e)},200,[e]);const u=d=>{const g=d.currentTarget.value;a(g)};return t.jsxs("div",{className:"w-full h-9 flex flex-row justify-start items-center py-2 px-3 rounded-md bg-gray-200 dark:bg-zinc-700",children:[t.jsx(v.Search,{className:"w-4 h-auto opacity-30 dark:text-gray-200"}),t.jsx("input",{className:"flex ml-2 w-24 grow text-sm outline-none bg-transparent dark:text-gray-200",type:"text",placeholder:n("memo.search-placeholder"),ref:i,value:e,onChange:u})]})},U=n=>{const o=G(`#${n}`,V.regexp);return!(!o||o[1]!==n)},it=n=>{const{destroy:o}=n,e=R(),a=C(),[i,u]=l.useState(""),[d,g]=l.useState([]),[x,N]=l.useState(!1),m=e.state.tags,h=d.filter(s=>!m.includes(s));l.useEffect(()=>{W().then(({data:s})=>{g(s.filter(k=>U(k)))})},[m]);const p=s=>{s.key==="Enter"&&S()},j=s=>{const k=s.target.value;u(k.trim())},b=async s=>{await e.upsertTag(s)},y=()=>{N(s=>!s)},S=async()=>{if(!U(i)){L.error(a("tag-list.invalid-tag-name"));return}try{await e.upsertTag(i),u("")}catch(s){console.error(s),L.error(s.response.data.message)}},D=async s=>{await e.deleteTag(s)},F=async()=>{for(const s of d)U(s)&&await e.upsertTag(s)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"dialog-header-container",children:[t.jsx("p",{className:"title-text",children:a("tag-list.create-tag")}),t.jsx("button",{className:"btn close-btn",onClick:()=>o(),children:t.jsx(v.X,{})})]}),t.jsxs("div",{className:"dialog-content-container !w-80",children:[t.jsx(q,{className:"mb-2",size:"md",placeholder:a("tag-list.tag-name"),value:i,onChange:j,onKeyDown:p,fullWidth:!0,startDecorator:t.jsx(v.Hash,{className:"w-4 h-auto"}),endDecorator:t.jsx(v.Check,{onClick:S,className:"w-4 h-auto cursor-pointer hover:opacity-80"})}),m.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"w-full mt-2 mb-1 text-sm text-gray-400",children:a("tag-list.all-tags")}),t.jsx("div",{className:"w-full flex flex-row justify-start items-start flex-wrap",children:Array.from(m).sort().map(s=>t.jsxs("span",{className:"max-w-[120px] text-sm mr-2 mt-1 font-mono cursor-pointer truncate dark:text-gray-300 hover:opacity-60 hover:line-through",onClick:()=>D(s),children:["#",s]},s))})]}),h.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mt-4 mb-1 text-sm w-full flex flex-row justify-start items-center",children:[t.jsx("span",{className:"text-gray-400 mr-2",children:a("tag-list.tag-suggestions")}),t.jsx(A,{size:"sm",variant:"outlined",onClick:y,children:a(x?"tag-list.hide":"tag-list.show")})]}),x&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-full flex flex-row justify-start items-start flex-wrap mb-2",children:h.map(s=>t.jsxs("span",{className:"max-w-[120px] text-sm mr-2 mt-1 font-mono cursor-pointer truncate dark:text-gray-300 hover:opacity-60",onClick:()=>b(s),children:["#",s]},s))}),t.jsx(A,{size:"sm",onClick:F,children:a("tag-list.save-all")})]})]})]})]})};function mt(){K({className:"create-tag-dialog",dialogName:"create-tag-dialog"},it)}const ut=()=>{const n=C(),o=E(),e=R(),a=e.state.tags,i=o.state,[u,d]=l.useState([]);return l.useEffect(()=>{e.fetchTags()},[]),l.useEffect(()=>{const g=Array.from(a).sort(),x={subTags:[]};for(const N of g){const m=N.split("/");let h=x,p="";for(let j=0;j<m.length;j++){const b=m[j];j===0?p+=b:p+="/"+b;let y=null;for(const S of h.subTags)if(S.text===p){y=S;break}y||(y={key:b,text:p,subTags:[]},h.subTags.push(y)),h=y}}d(x.subTags)},[a]),t.jsxs("div",{className:"flex flex-col justify-start items-start w-full mt-2 h-auto shrink-0 flex-nowrap hide-scrollbar",children:[t.jsxs("div",{className:"flex flex-row justify-start items-center w-full px-4",children:[t.jsx("span",{className:"text-sm leading-6 font-mono text-gray-400",children:n("common.tags")}),t.jsx("button",{onClick:()=>mt(),className:"flex flex-col justify-center items-center w-5 h-5 bg-gray-200 dark:bg-zinc-700 rounded ml-2 hover:shadow",children:t.jsx(v.Plus,{className:"w-4 h-4 text-gray-400"})})]}),t.jsx("div",{className:"flex flex-col justify-start items-start relative w-full h-auto flex-nowrap mt-2 mb-2",children:u.map((g,x)=>t.jsx(Q,{tag:g,tagQuery:i.tag},g.text+"-"+x))})]})},Q=n=>{const o=E(),{tag:e,tagQuery:a}=n,i=a===e.text,u=e.subTags.length>0,[d,g]=J(!1),x=()=>{i?o.setTagFilter(void 0):o.setTagFilter(e.text)},N=m=>{m.stopPropagation(),g()};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"relative group flex flex-row justify-between items-center w-full h-10 py-0 px-4 mt-px first:mt-1 rounded-lg text-base cursor-pointer select-none shrink-0 hover:opacity-60",onClick:x,children:[t.jsxs("div",{className:`flex flex-row justify-start items-center truncate shrink leading-5 mr-1 text-black dark:text-gray-200 ${i&&"text-green-600"}`,children:[t.jsx("span",{className:"block w-4 shrink-0",children:"#"}),t.jsx("span",{className:"truncate",children:e.key})]}),t.jsx("div",{className:"flex flex-row justify-end items-center",children:u?t.jsx("span",{className:`flex flex-row justify-center items-center w-6 h-6 shrink-0 transition-all rotate-0 ${d&&"rotate-90"}`,onClick:N,children:t.jsx(v.ChevronRight,{className:"w-5 h-5 opacity-80 dark:text-gray-400"})}):null})]}),u?t.jsx("div",{className:`w-full flex flex-col justify-start items-start h-auto ml-5 pl-1 border-l-2 border-l-gray-200 dark:border-l-gray-400 ${!d&&"!hidden"}`,children:e.subTags.map((m,h)=>t.jsx(Q,{tag:m,tagQuery:a},m.text+"-"+h))}):null]})};const $={width:10,height:7},B=(n,o)=>{const e=[];for(let a=1;a<=n;a++)e.push({timestamp:o+z*a,count:0});return e},dt=()=>{const n=C(),o=E(),e=I(),a=X(),i=H(Date.now()),u=new Date(i).getDay()+1,d=new Array(7-u).fill(0),g=($.width-1)*$.height+u,x=i-g*z,N=a.state.memos,[m,h]=l.useState(0),[p,j]=l.useState(0),[b,y]=l.useState(B(g,x)),[S,D]=l.useState(null),F=l.useRef(null),s=e.getCurrentUsername();l.useEffect(()=>{e.getUserByUsername(s).then(r=>{r&&j(Math.ceil((Date.now()-Y(r.createdTs))/1e3/3600/24))})},[s]),l.useEffect(()=>{Z(s).then(({data:r})=>{h(r.length);const f=B(g,x);for(const c of r){const w=(H(c*1e3)-x)/864e5-1;if(w>=0){const T=+w.toFixed(0);f[T].count+=1}}y([...f])}).catch(r=>{console.error(r)})},[N.length,s]);const k=l.useCallback((r,f)=>{const c=document.createElement("div");c.className="usage-detail-container pop-up";const w=tt(r.target);c.style.left=w.left+"px",c.style.top=w.top-2+"px";const T={amount:f.count,date:et(f.timestamp)};c.innerHTML=f.count===1?n("heatmap.memo-on",T):n("heatmap.memos-on",T),document.body.appendChild(c),c.offsetLeft-c.clientWidth/2<0&&(c.style.left=w.left+c.clientWidth*.4+"px",c.className+=" offset-left")},[]),_=l.useCallback(()=>{document.body.querySelectorAll("div.usage-detail-container.pop-up").forEach(r=>r.remove())},[]),O=l.useCallback(r=>{var f;((f=o.getState().duration)==null?void 0:f.from)===r.timestamp?(o.setFromAndToFilter(),D(null)):r.count>0&&(o.setFromAndToFilter(r.timestamp,r.timestamp+z),D(r))},[]),M={amount:m,period:"",date:""};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"usage-heat-map-wrapper",ref:F,children:[t.jsxs("div",{className:"usage-heat-map",children:[b.map((r,f)=>{const c=r.count,w=c<=0?"":c<=1?"stat-day-l1-bg":c<=2?"stat-day-l2-bg":c<=4?"stat-day-l3-bg":"stat-day-l4-bg";return t.jsx("div",{className:"stat-wrapper",onMouseEnter:T=>k(T,r),onMouseLeave:_,onClick:()=>O(r),children:t.jsx("span",{className:`stat-container ${w} ${S===r?"current":""} ${i===r.timestamp?"today":""}`})},f)}),d.map((r,f)=>t.jsx("div",{className:"stat-wrapper",children:t.jsx("span",{className:"stat-container null"})},f))]}),t.jsxs("div",{className:"day-tip-text-container",children:[t.jsx("span",{className:"tip-text",children:n("days.sun")}),t.jsx("span",{className:"tip-text"}),t.jsx("span",{className:"tip-text",children:n("days.tue")}),t.jsx("span",{className:"tip-text"}),t.jsx("span",{className:"tip-text",children:n("days.thu")}),t.jsx("span",{className:"tip-text"}),t.jsx("span",{className:"tip-text",children:n("days.sat")})]})]}),t.jsxs("p",{className:"w-full pl-4 text-xs -mt-2 mb-3 text-gray-400 dark:text-zinc-400",children:[t.jsxs("span",{className:"font-medium text-gray-500 dark:text-zinc-300 number",children:[m," "]}),n(m===1?"heatmap.memo-in":"heatmap.memos-in",M)," ",t.jsxs("span",{className:"font-medium text-gray-500 dark:text-zinc-300",children:[p," "]}),n(p===1?"heatmap.day":"heatmap.days",M)]})]})},gt=()=>{const n=st(),o=I(),e=n.state.showHomeSidebar;return t.jsxs("div",{className:`fixed md:sticky top-0 left-0 w-full md:w-56 h-full shrink-0 pointer-events-none md:pointer-events-auto z-10 ${e&&"pointer-events-auto"}`,children:[t.jsx("div",{className:`fixed top-0 left-0 w-full h-full bg-black opacity-0 pointer-events-none transition-opacity duration-300 md:!hidden ${e&&"opacity-60 pointer-events-auto"}`,onClick:()=>n.setHomeSidebarStatus(!1)}),t.jsxs("aside",{className:`absolute md:relative top-0 right-0 w-56 pr-2 md:w-full h-full max-h-screen overflow-auto hide-scrollbar flex flex-col justify-start items-start py-4 z-30 bg-zinc-100 dark:bg-zinc-800 md:bg-transparent md:shadow-none transition-all duration-300 translate-x-full md:translate-x-0 ${e&&"!translate-x-0 shadow-2xl"}`,children:[t.jsx("div",{className:"px-4 pr-8 mb-4 w-full",children:t.jsx(ct,{})}),t.jsx(dt,{}),!o.isVisitorMode()&&t.jsx(t.Fragment,{children:t.jsx(ut,{})})]})]})},pt=()=>{const n=C(),o=at(),e=I(),a=e.state.user;return l.useEffect(()=>{const i=e.getCurrentUsername();e.getUserByUsername(i).catch(u=>{console.error(u),L.error(n("message.user-not-found"))})},[e.getCurrentUsername()]),l.useEffect(()=>{a!=null&&a.setting.locale&&o.setLocale(a.setting.locale)},[a==null?void 0:a.setting.locale]),t.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[t.jsxs("div",{className:"flex-grow shrink w-auto px-4 sm:px-2 sm:pt-4",children:[t.jsx(nt,{}),t.jsxs("div",{className:"w-full h-auto flex flex-col justify-start items-start bg-zinc-100 dark:bg-zinc-800 rounded-lg",children:[!e.isVisitorMode()&&t.jsx(ot,{className:"mb-2"}),t.jsx(rt,{})]}),t.jsx(lt,{})]}),t.jsx(gt,{})]})};export{pt as default};
